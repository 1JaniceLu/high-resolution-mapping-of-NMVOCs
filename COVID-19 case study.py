#!/usr/bin/env python
# coding: utf-8

# In[1]:


import pandas as pd
import os
import numpy as np


# In[ ]:


data=pd.read_table("/result/all hour.txt",header=0,sep=",")
data=data.T
data=data.reset_index(drop=True)  #data: col: all hours, row:10670row


# In[ ]:


name="/input/onegrid time variable(with date).xlsx"
date=pd.read_excel(name,index_col=None,header=0)
date["month"]=date["date"].dt.month
data=pd.concat([date,data],axis=1)
data["year"]=date["date"].dt.year


# # different periods data

# ## P1(1.1~1.23) 

# In[ ]:


p1month=data[data['month'].isin([1])]
p1day=pd.DataFrame()
for i in range(1,24):
    zan=p1month[p1month['doy'].isin([i])]
    p1day=pd.concat([p1day,zan],axis=0)
p12019=p1day[p1day['year'].isin([2019])]
p12020=p1day[p1day['year'].isin([2020])]
p12019.to_excel("/result/covid19/p12019.xlsx",header=True,index=False)
p12020.to_excel("/result/covid19/p12020.xlsx",header=True,index=False)


# ## P2(1.24~2.16) 

# In[ ]:


p2month=pd.DataFrame()
for i in range(1,3):
    zan=data[data['month'].isin([i])]
    p2month=pd.concat([p2month,zan],axis=0)


# In[ ]:


p2day=pd.DataFrame()
for i in range(24,48):
    zan=p2month[p2month['doy'].isin([i])]
    p2day=pd.concat([p2day,zan],axis=0)
p22019=p2day[p2day['year'].isin([2019])]
p22020=p2day[p2day['year'].isin([2020])]
p22019.to_excel("/result/covid19/p22019.xlsx",header=True,index=False)
p22020.to_excel("/result/covid19/p22020.xlsx",header=True,index=False)


# ## P3(2.17~3.23) 

# In[ ]:


p3month=pd.DataFrame()
for i in range(2,4):
    zan=data[data['month'].isin([i])]
    p3month=pd.concat([p3month,zan],axis=0)


# In[ ]:


p32019=p3month[p3month['year'].isin([2019])]
p3day2019=pd.DataFrame()
for i in range(48,83):
    zan=p32019[p32019['doy'].isin([i])]
    p3day2019=pd.concat([p3day2019,zan],axis=0)


# In[ ]:


p32020=p3month[p3month['year'].isin([2020])]
p3day2020=pd.DataFrame()
for i in range(48,84):
    zan=p32020[p32020['doy'].isin([i])]
    p3day2020=pd.concat([p3day2020,zan],axis=0)
p3day2019.to_excel("/result/covid19/p32019.xlsx",header=True,index=False)
p3day2020.to_excel("/result/covid19/p32020.xlsx",header=True,index=False)


# ## P4(3.24~4.3) 

# In[ ]:


p4month=pd.DataFrame()
for i in range(3,5):
    zan=data[data['month'].isin([i])]
    p4month=pd.concat([p4month,zan],axis=0)


# In[ ]:


p42019=p4month[p4month['year'].isin([2019])]
p4day2019=pd.DataFrame()
for i in range(83,121):
    zan=p42019[p42019['doy'].isin([i])]
    p4day2019=pd.concat([p4day2019,zan],axis=0)


# In[ ]:


p42020=p4month[p4month['year'].isin([2020])]
p4day2020=pd.DataFrame()
for i in range(84,122):
    zan=p42020[p42020['doy'].isin([i])]
    p4day2020=pd.concat([p4day2020,zan],axis=0)
p4day2019.to_excel("/result/covid19/p42019.xlsx",header=True,index=False)
p4day2020.to_excel("/result/covid19/p42020.xlsx",header=True,index=False)


# # Dif calculation

# In[ ]:


p12019=p12019.drop(["date","doy","hour","dayofweek","month","year"],axis=1)
p12020=p12020.drop(["date","doy","hour","dayofweek","month","year"],axis=1)
p22019=p22019.drop(["date","doy","hour","dayofweek","month","year"],axis=1)
p22020=p22020.drop(["date","doy","hour","dayofweek","month","year"],axis=1)
p3day2019=p3day2019.drop(["date","doy","hour","dayofweek","month","year"],axis=1)
p3day2020=p3day2020.drop(["date","doy","hour","dayofweek","month","year"],axis=1)
p4day2019=p4day2019.drop(["date","doy","hour","dayofweek","month","year"],axis=1)
p4day2020=p4day2020.drop(["date","doy","hour","dayofweek","month","year"],axis=1)


# In[ ]:


row_mean_covid=pd.DataFrame()
row_mean_covid["p12019"]=p12019.mean(axis=0)
row_mean_covid["p12020"]=p12020.mean(axis=0)
row_mean_covid["p22019"]=p22019.mean(axis=0)
row_mean_covid["p22020"]=p22020.mean(axis=0)
row_mean_covid["p3day2019"]=p3day2019.mean(axis=0)
row_mean_covid["p3day2020"]=p3day2020.mean(axis=0)
row_mean_covid["p4day2019"]=p4day2019.mean(axis=0)
row_mean_covid["p4day2020"]=p4day2020.mean(axis=0)


# In[ ]:


dif=pd.DataFrame()
dif["p1"]=row_mean_covid["p12020"]-row_mean_covid["p12019"]
dif["p2"]=row_mean_covid["p22020"]-row_mean_covid["p22019"]
dif["p3"]=row_mean_covid["p3day2020"]-row_mean_covid["p3day2019"]
dif["p4"]=row_mean_covid["p4day2020"]-row_mean_covid["p4day2019"]


# # Dif map

# In[ ]:


dif.fillna(-9999,inplace=True)
dif.iloc[:,1:]=dif.iloc[:,1:].apply(str)


# In[ ]:


def func(dif):  
    return ",".join(dif.values)
df=dif.groupby(by="number").agg(func).reset_index()
df


# In[ ]:


dif_p1=pd.DataFrame()
for p in range(110):
    zan=pd.DataFrame(df['p1'].map(lambda x:x.split(',')[p]))
    dif_p1=pd.concat([dif_p1,zan],axis=1)
    p=p+1
name1="/covid19/map/difp1.txt"
dif_p1.to_csv(name1,sep='\t',header=None,index=False)


# In[ ]:


#arcgis绘图需要的地理信息
s='''ncols         110
nrows         97
xllcorner     295195.59204141
yllcorner     3395055.7416003
cellsize      1000
NODATA_value  -9999
'''                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 


# In[ ]:


with open("G:\\shanghai\\predict\\covid19\\map\\difp1.txt",'r') as f:
    data=f.readlines()
    data.insert(0,s)
    name1="G:\\shanghai\\predict\\covid19\\map\\difp1_totif.txt"
    with open(name1,'w') as f1:
        f1.writelines(data)
#then use Arcgis for figure 

